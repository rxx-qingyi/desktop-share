# 快速开始指南

本指南将帮助你快速启动和使用桌面共享系统。

## 系统要求

- **Go**: 1.21 或更高版本
- **Node.js**: 18.0 或更高版本
- **npm**: 9.0 或更高版本

## 一、安装依赖

### 1. 安装 Go 后端依赖

```bash
cd server
go mod download
cd ..
```

### 2. 安装 Web 客户端依赖

```bash
cd web-client
npm install
cd ..
```

### 3. 安装桌面客户端依赖

```bash
cd desktop-client
npm install
cd ..
```

## 二、启动服务

### 方式 1：使用启动脚本（推荐）

在项目根目录运行：

```bash
./start.sh
```

这将自动启动后端服务和 Web 客户端。

### 方式 2：手动启动各个服务

#### 启动后端服务

```bash
cd server
go run cmd/server/main.go
```

后端将在 `http://localhost:8080` 启动。

#### 启动 Web 客户端

打开新终端窗口：

```bash
cd web-client
npm run dev
```

Web 客户端将在 `http://localhost:3000` 启动。

#### 启动桌面客户端

打开新终端窗口：

```bash
cd desktop-client
npm run dev
```

桌面应用将自动打开。

## 三、使用流程

### 步骤 1：使用桌面客户端开始推流

1. 打开桌面客户端应用
2. 在房间选择界面，输入房间名称，点击"创建并推流"
   - 或选择已有房间，点击"选择推流"
3. 点击"开始推流"按钮
4. 选择要共享的屏幕或窗口
5. 授权后，推流将自动开始
6. 可以看到本地预览画面

### 步骤 2：使用 Web 客户端观看

1. 打开浏览器访问 `http://localhost:3000`
2. 在房间列表中找到正在直播的房间（显示"正在直播"状态）
3. 点击"加入观看"按钮
4. 等待连接建立，即可看到实时画面

## 四、端口说明

| 服务 | 地址 | 说明 |
|------|------|------|
| Go 后端 API | http://localhost:8080/api | HTTP API 端点 |
| Go 后端 WebSocket | ws://localhost:8080/ws | WebRTC 信令服务 |
| Web 客户端 | http://localhost:3000 | Web 观看界面 |
| Vite 开发服务器 | http://localhost:5173 | 桌面客户端渲染进程 |

## 五、常见问题

### Q1: 推流端无法采集屏幕？

**macOS 用户**：
- 打开 系统偏好设置 → 安全性与隐私 → 隐私 → 屏幕录制
- 确保应用已被授权

**Windows 用户**：
- 可能需要以管理员权限运行应用

### Q2: Web 端无法看到视频？

检查：
1. 后端服务是否正常运行
2. 桌面端是否已开始推流
3. 浏览器控制台是否有错误信息
4. 网络连接是否正常

### Q3: 连接失败或延迟高？

- 确保所有服务在同一局域网内
- 检查防火墙设置
- 生产环境需要配置 TURN 服务器

### Q4: 如何修改配置？

**后端配置**：
- 复制 `.env.example` 为 `.env`
- 修改端口、STUN/TURN 服务器等配置

**前端配置**：
- Web 客户端：修改 `web-client/vite.config.ts` 中的代理设置
- 桌面客户端：修改服务地址在相应的 service 文件中

## 六、开发调试

### 查看后端日志

后端会输出详细的连接日志，包括：
- WebSocket 连接状态
- WebRTC 协商过程
- ICE 连接状态

### 查看前端日志

打开浏览器开发者工具（F12），查看 Console 标签页。

### 调试 Electron

桌面客户端会自动打开开发者工具，可以查看渲染进程的日志。

## 七、测试场景

### 场景 1：单推流多观看

1. 启动一个桌面客户端推流
2. 多个浏览器标签页同时观看
3. 验证多人观看的 SFU 转发功能

### 场景 2：切换推流端

1. 第一个桌面客户端开始推流
2. 停止推流
3. 第二个桌面客户端接管推流
4. Web 端观众需要刷新页面重新连接

## 八、生产部署建议

生产环境部署时需要注意：

1. **使用 HTTPS 和 WSS**
   - WebRTC 在非 localhost 环境需要 HTTPS
   - 配置 SSL 证书

2. **配置 TURN 服务器**
   - NAT 穿透需要 TURN 服务
   - 推荐使用 coturn

3. **添加身份认证**
   - 实现 JWT 或 OAuth 认证
   - 限制房间访问权限

4. **监控和日志**
   - 添加性能监控
   - 记录连接状态和错误日志

5. **优化配置**
   - 调整视频编码参数
   - 配置带宽限制

## 九、下一步

- 查看各模块的 README 了解更多细节
- 根据需求定制化功能
- 添加更多特性（录制、聊天、远程控制等）

## 需要帮助？

如果遇到问题，请检查：
1. 各模块的 README 文档
2. 后端和前端的日志输出
3. 浏览器开发者工具的 Console 和 Network 标签
